@model IEnumerable<WebApplicationMvc.ViewModels.PacientesRecientesViewModel>

@{
    // Layout = null;
  var counter = 1;
}

@* <!DOCTYPE html> *@
@* *@
@* <html> *@
@* <head> *@
@*     <title>title</title> *@
@* </head> *@
@* <body> *@
@* <div> *@
@*        *@
@* </div> *@
@* </body> *@
@* </html> *@


@* refresh *@
<div class="row">
  <div class="col">
    <h3 class="text-center">Dashboard</h3>
  </div><div class="col">
    <a asp-controller="Home" asp-action="Dashboard" class="btn btn-sm btn-outline-primary">Actualizar</a>
  </div>
</div>
<br>
@if (true)
{
  <div class="row">
    <div class="col-6">
      <!-- DONUT CHART -->
      <div class="card card-danger">
        <div class="card-header">
          <strong>Tipos de atencion mas comunes.</strong>
        </div>
        <div class="card-body">
          <canvas id="donutChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
        </div>
        <!-- /.card-body -->
      </div>
      <!-- /.card -->
    </div>
    <div class="col-6">
      <!-- BAR CHART -->
      <div class="card card-success">
        <div class="card-header">
          <strong>Cantidad de pacientes por mes.</strong>
        </div>
        <div class="card-body">
          <div class="chart">
            <canvas id="barChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
          </div>
        </div>
        <!-- /.card-body -->
      </div>
      <!-- /.card -->
             
    </div>
  </div>
  <hr>
  <div class="row">
    @* <div class="col"> *@
    @*   <h2 class="text-center"> hi</h2> *@
    @* </div> *@
    @* <div class="col"> *@
    @*   <button class="btn btn-sm btn-outline-success">Exportar excel(prueba...)</button> *@
    @* </div> *@
    <div class="col">
      <h2 class="text-center">Lista de pacientes atendidos recientemente.</h2>
    </div>
  </div>
      <div class="table-responsive">
    <table class="table table-striped table-sm">
      <thead>
      <tr>
        <th>#</th>
        <th>Paciente</th>
        <th>Categoria</th>
        <th>Fecha hora</th>
      </tr>
      </thead>
      <tbody>
      @foreach (var item in Model)
      {
        <tr>
          <td>@(counter++)</td>
          <td>@item.Nombres</td>
          <td>@item.Categoria</td>
          <td>@item.FechaHora.ToShortDateString() - @item.FechaHora.ToShortTimeString()</td>
        </tr>
      }
      </tbody>
    </table>
  </div>
}
else
{
    <p>En proceso ... </p>
}


@section Scripts
{
  <script src="~/lib/Chart.js@3.8.0/chart.js"></script>
  <script>
      $(function () {
        /* ChartJS
         * -------
         * Here we will create a few charts using ChartJS
         */
    
        var donutChartCanvas = $('#donutChart').get(0).getContext('2d')
        var donutData        = {
          labels: [],
          datasets: [
            {
              data: [],
              backgroundColor : ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de'],
            }
          ]
        }
       
        var urlChart = "/home/AtencionesMensual";
        var urlDonut = "/home/TipoAtencion";
        
        $.ajax({
          url: urlDonut,
          cache: false,
          success: function(data){
            console.log(data);
            donutData.labels = [];
            donutData.datasets[0].data = [];
            
            data.forEach(a => {
              donutData.labels.push(a.label);
              donutData.datasets[0].data.push(a.value);
            });
            
            new Chart(donutChartCanvas, {type: 'doughnut', data: donutData })
          }
        });
        
        //-------------
        //- BAR CHART -
        //-------------
        var barChartCanvas = $('#barChart').get(0).getContext('2d')
        var chartOptions = {
          type:"bar",
          data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
              label: '# de pacientes por mes',
              data: [12, 19, 3, 5, 2, 3],
            }]
          },
        };
        
        $.ajax({
          url: urlChart,
          cache: false,
          success: function(data){
            console.log(data);
            chartOptions.data.labels = [];
            chartOptions.data.datasets[0].data = [];
            data.forEach(b => {
              chartOptions.data.labels.push(b.month);
              chartOptions.data.datasets[0].data.push(b.data);
            });
            
            new Chart(barChartCanvas, chartOptions);
          }
        });
                
        
      })
    </script>
}
